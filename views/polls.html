<% layout('layout') -%>

<h3>Polls</h3>

<form method="post" action="/admin/polls/create" class="community-card">
  <input name="shop" placeholder="shop (your-store.myshopify.com)" class="community-input" required />
  <!-- threadId is optional in the route, so don't force it here -->
  <!-- <input name="threadId" placeholder="Thread ID" class="community-input" /> -->
  <input name="question" placeholder="Poll question" class="community-input" required />
  <textarea name="options" class="community-textarea" rows="4" placeholder="One option per line"></textarea>
  <button class="community-btn" type="submit">Create Poll</button>
</form>

<div style="margin-top:12px;">
  <% if ((items || []).length === 0) { %>
    <div class="community-card small">(no polls yet)</div>
  <% } %>

  <% (items || []).forEach(function(p){ %>
    <div class="community-card">
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <strong><%= p.question || '(no question)' %></strong>
        <span class="badge"><%= p.status === 'closed' ? 'closed' : 'open' %></span>
        <span class="small">Â· <%= (p.options || []).length %> options</span>
      </div>

      <ul class="clean" style="margin-top:6px">
        <% if ((p.options || []).length) { %>
          <% (p.options || []).forEach(function (o, i) { %>
            <li><span class="badge"><%= o.text || ('Option ' + (i + 1)) %></span></li>
          <% }) %>
        <% } else { %>
          <li class="small">(no options)</li>
        <% } %>
      </ul>

      <form method="post" action="/admin/polls/<%= p._id %>/close" style="margin-top:8px">
        <button class="community-btn" type="submit">Close</button>
      </form>
    </div>
  <% }) %>
</div>
